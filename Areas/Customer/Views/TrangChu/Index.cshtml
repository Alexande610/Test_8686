@{
    ViewData["Title"] = "Trang Chủ - Mỹ Phẩm Thiên Nhiên";
}

<!-- Banner chính -->
<div class="hero-banner">
    <div>
        <h1>Khuyến mãi đặc biệt!</h1>
        <p>Giảm giá lên đến 50% cho sản phẩm mới</p>
        <a asp-area="Customer" asp-controller="SanPham" asp-action="Index" class="btn btn-danger">Xem ngay</a>
    </div>
</div>

<!-- Danh mục sản phẩm nổi bật -->
<div class="product-category">
    <div class="container">
        <h2 class="text-center section-title">Danh mục sản phẩm nổi bật</h2>
        
        @{
            var danhMucCounts = ViewBag.DanhMucs as List<dynamic> ?? new List<dynamic>();
            var count1 = danhMucCounts.Count > 0 ? danhMucCounts[0].SoLuongSanPham : 0;
            var count2 = danhMucCounts.Count > 1 ? danhMucCounts[1].SoLuongSanPham : 0;
            var count3 = danhMucCounts.Count > 2 ? danhMucCounts[2].SoLuongSanPham : 0;
            var count4 = danhMucCounts.Count > 3 ? danhMucCounts[3].SoLuongSanPham : 0;
            var count5 = danhMucCounts.Count > 4 ? danhMucCounts[4].SoLuongSanPham : 0;
            var count6 = danhMucCounts.Count > 5 ? danhMucCounts[5].SoLuongSanPham : 0;
        }
        
        <!-- Debug info - sẽ xóa sau -->
        <div style="display:none;">
            Debug: DanhMucs count = @(danhMucCounts?.Count ?? 0)
            @if (danhMucCounts?.Count > 0)
            {
                <div>First category: @danhMucCounts[0].TenDanhMuc - @danhMucCounts[0].SoLuongSanPham</div>
            }
        </div>
        
        <!-- Carousel danh mục -->
        <div id="categoryCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="4000">
            <div class="carousel-inner">
                <!-- Slide 1 -->
                <div class="carousel-item active">
                    <div class="row justify-content-center">
                        <!-- Danh mục 1: Chăm sóc da -->
                        <div class="col-lg-2 col-md-3 col-sm-4 col-6 mb-4">
                            <div class="category-card-new">
                                <a asp-area="Customer" asp-controller="SanPham" asp-action="Index" asp-route-category="skincare" class="text-decoration-none">
                                    <div class="category-image-container">
                                        <img src="https://images.unsplash.com/photo-1570194065650-d99fb4bedf0a?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80" 
                                             alt="Chăm sóc da" class="category-image">
                                        <div class="category-overlay">
                                            <div class="category-gradient"></div>
                                            <div class="category-content">
                                                <h6 class="category-title">Chăm sóc da</h6>
                                                <small class="category-count">@count1 sản phẩm</small>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>

                        <!-- Danh mục 2: Trang điểm -->
                        <div class="col-lg-2 col-md-3 col-sm-4 col-6 mb-4">
                            <div class="category-card-new">
                                <a asp-area="Customer" asp-controller="SanPham" asp-action="Index" asp-route-category="makeup" class="text-decoration-none">
                                    <div class="category-image-container">
                                        <img src="https://images.unsplash.com/photo-1522335789203-aabd1fc54bc9?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80" 
                                             alt="Trang điểm" class="category-image">
                                        <div class="category-overlay">
                                            <div class="category-gradient makeup-gradient"></div>
                                            <div class="category-content">
                                                <h6 class="category-title">Trang điểm</h6>
                                                <small class="category-count">@count2 sản phẩm</small>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>

                        <!-- Danh mục 3: Dưỡng tóc -->
                        <div class="col-lg-2 col-md-3 col-sm-4 col-6 mb-4">
                            <div class="category-card-new">
                                <a asp-area="Customer" asp-controller="SanPham" asp-action="Index" asp-route-category="haircare" class="text-decoration-none">
                                    <div class="category-image-container">
                                        <img src="https://images.unsplash.com/photo-1559599101-f09722fb4948?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80" 
                                             alt="Dưỡng tóc" class="category-image">
                                        <div class="category-overlay">
                                            <div class="category-gradient haircare-gradient"></div>
                                            <div class="category-content">
                                                <h6 class="category-title">Dưỡng tóc</h6>
                                                <small class="category-count">@count3 sản phẩm</small>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>

                        <!-- Danh mục 4: Chống nắng -->
                        <div class="col-lg-2 col-md-3 col-sm-4 col-6 mb-4">
                            <div class="category-card-new">
                                <a asp-area="Customer" asp-controller="SanPham" asp-action="Index" asp-route-category="suncare" class="text-decoration-none">
                                    <div class="category-image-container">
                                        <img src="https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80" 
                                             alt="Chống nắng" class="category-image">
                                        <div class="category-overlay">
                                            <div class="category-gradient suncare-gradient"></div>
                                            <div class="category-content">
                                                <h6 class="category-title">Chống nắng</h6>
                                                <small class="category-count">@count4 sản phẩm</small>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>

                        <!-- Danh mục 5: Tinh dầu -->
                        <div class="col-lg-2 col-md-3 col-sm-4 col-6 mb-4">
                            <div class="category-card-new">
                                <a asp-area="Customer" asp-controller="SanPham" asp-action="Index" asp-route-category="essential-oils" class="text-decoration-none">
                                    <div class="category-image-container">
                                        <img src="https://images.unsplash.com/photo-1594736797933-d0a9ba3a5db7?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80" 
                                             alt="Tinh dầu" class="category-image">
                                        <div class="category-overlay">
                                            <div class="category-gradient oils-gradient"></div>
                                            <div class="category-content">
                                                <h6 class="category-title">Tinh dầu</h6>
                                                <small class="category-count">@count5 sản phẩm</small>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>

                        <!-- Danh mục 6: Chăm sóc cơ thể -->
                        <div class="col-lg-2 col-md-3 col-sm-4 col-6 mb-4">
                            <div class="category-card-new">
                                <a asp-area="Customer" asp-controller="SanPham" asp-action="Index" asp-route-category="body-care" class="text-decoration-none">
                                    <div class="category-image-container">
                                        <img src="https://images.unsplash.com/photo-1556228720-195a672e8a03?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80" 
                                             alt="Chăm sóc cơ thể" class="category-image">
                                        <div class="category-overlay">
                                            <div class="category-gradient bodycare-gradient"></div>
                                            <div class="category-content">
                                                <h6 class="category-title">Chăm sóc cơ thể</h6>
                                                <small class="category-count">@count6 sản phẩm</small>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Indicators -->
            <div class="carousel-indicators">
                <button type="button" data-bs-target="#categoryCarousel" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
            </div>
        </div>
    </div>
</div>

<!-- Sản phẩm bán chạy / Gợi ý cho bạn -->
<div class="container bestselling-products-section">
    <h2 class="text-center section-title">Sản phẩm bán chạy</h2>
    
    <!-- Carousel sản phẩm -->
    <div id="productCarousel" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner">
            <!-- Slide 1 -->
            <div class="carousel-item active">
                <div class="row justify-content-center">
                    @if (ViewBag.SanPhamBanChay != null)
                    {
                        var sanPhams = ViewBag.SanPhamBanChay as List<LittleFishBeauty.Models.SanPham>;
                        <!-- DEBUG: Kiểm tra data -->
                        @if (sanPhams != null && sanPhams.Any())
                        {
                            <!-- DEBUG: Có @sanPhams.Count sản phẩm từ database -->
                            var count = 0;
                            foreach (var sanPham in sanPhams.Take(4))
                            {
                                <!-- Sản phẩm từ database: @sanPham.TenSanPham - @sanPham.GiaBan.ToString("N0") VND -->
                                <div class="col-md-3 col-sm-6 mb-4">
                                    <a asp-area="Customer" asp-controller="ChiTiet" asp-action="Index" asp-route-id="@sanPham.ID_SanPham" class="text-decoration-none">
                                        <div class="product-card">
                                            <div class="product-image-container">
                                            @{
                                                var defaultImage = "https://images.unsplash.com/photo-1556228453-efd6c1ff04f6?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80";
                                                var anhChinh = defaultImage;
                                                if (sanPham.AnhSanPhams != null)
                                                {
                                                    foreach (var anh in sanPham.AnhSanPhams)
                                                    {
                                                        if (anh.LoaiAnh == "chinh")
                                                        {
                                                            anhChinh = anh.DuongDan;
                                                            break;
                                                        }
                                                    }
                                                }
                                            }
                                            <img src="@anhChinh" class="product-image" alt="@sanPham.TenSanPham">
                                        </div>
                                        <div class="product-info">
                                            <h6 class="product-name">@sanPham.TenSanPham</h6>
                                            <p class="product-description">@(sanPham.MoTa?.Length > 50 ? sanPham.MoTa.Substring(0, 50) + "..." : sanPham.MoTa)</p>
                                            <div class="product-rating">
                                                @{
                                                    // Logic đánh giá sao: nếu chưa có đánh giá thì hiển thị 5 sao chưa tô vàng
                                                    int rating = 0; // Chưa có đánh giá
                                                    int totalStars = 5;
                                                }
                                                @for (int i = 1; i <= totalStars; i++)
                                                {
                                                    if (rating > 0 && i <= rating)
                                                    {
                                                        <span class="star filled">★</span>
                                                    }
                                                    else
                                                    {
                                                        <span class="star">☆</span>
                                                    }
                                                }
                                                <span class="review-count">(0)</span>
                                            </div>
                                            <div class="product-price">
                                                <span class="current-price">@sanPham.GiaBan.ToString("N0")₫</span>
                                            </div>
                                            <div class="product-actions">
                                                <button class="btn btn-primary btn-sm flex-fill" onclick="addToCart(@sanPham.ID_SanPham, event)">Thêm giỏ hàng</button>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                            count++;
                            }
                        }
                        else
                        {
                            <!-- DEBUG: sanPhams is null or empty -->
                        }
                    }
                    else
                    {
                        <!-- Fallback: hiển thị sản phẩm tĩnh nếu không có dữ liệu -->
                        <div class="col-md-3 col-sm-6 mb-4">
                            <a href="#" class="text-decoration-none">
                                <div class="product-card">
                                    <div class="product-image-container">
                                        <img src="https://images.unsplash.com/photo-1556228453-efd6c1ff04f6?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80" 
                                             class="product-image" alt="Kem chống nắng SPF 50">
                                    </div>
                                    <div class="product-info">
                                        <h6 class="product-name">Kem chống nắng SPF 50</h6>
                                        <p class="product-description">Kem chống nắng vật lý an toàn cho da</p>
                                        <div class="product-rating">
                                            <span class="star">☆</span>
                                            <span class="star">☆</span>
                                            <span class="star">☆</span>
                                            <span class="star">☆</span>
                                            <span class="star">☆</span>
                                            <span class="review-count">(0)</span>
                                        </div>
                                        <div class="product-price">
                                            <span class="current-price">320.000₫</span>
                                        </div>
                                        <div class="product-actions">
                                            <button class="btn btn-primary btn-sm flex-fill">Thêm giỏ hàng</button>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </div>

                        <div class="col-md-3 col-sm-6 mb-4">
                            <a href="#" class="text-decoration-none">
                                <div class="product-card">
                                    <div class="product-image-container">
                                        <img src="https://images.unsplash.com/photo-1556228578-8c89e6adf883?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80" 
                                             class="product-image" alt="Kem dưỡng ẩm thiên nhiên">
                                    </div>
                                    <div class="product-info">
                                        <h6 class="product-name">Kem dưỡng ẩm thiên nhiên</h6>
                                        <p class="product-description">Kem dưỡng ẩm từ chiết xuất lô hội và vitamin E</p>
                                        <div class="product-rating">
                                            <span class="star">☆</span>
                                            <span class="star">☆</span>
                                            <span class="star">☆</span>
                                            <span class="star">☆</span>
                                            <span class="star">☆</span>
                                            <span class="review-count">(0)</span>
                                        </div>
                                        <div class="product-price">
                                            <span class="current-price">350.000₫</span>
                                        </div>
                                        <div class="product-actions">
                                            <button class="btn btn-primary btn-sm flex-fill">Thêm giỏ hàng</button>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </div>

                        <div class="col-md-3 col-sm-6 mb-4">
                            <a href="#" class="text-decoration-none">
                                <div class="product-card">
                                    <div class="product-image-container">
                                        <img src="Sữa rửa mặt tạo bọt" 
                                             class="product-image" alt="Sữa rửa mặt tạo bọt">
                                    </div>
                                    <div class="product-info">
                                        <h6 class="product-name">Sữa rửa mặt tạo bọt</h6>
                                        <p class="product-description">Sữa rửa mặt tạo bọt nhẹ nhàng</p>
                                        <div class="product-rating">
                                            <span class="star">☆</span>
                                            <span class="star">☆</span>
                                            <span class="star">☆</span>
                                            <span class="star">☆</span>
                                            <span class="star">☆</span>
                                            <span class="review-count">(0)</span>
                                        </div>
                                        <div class="product-price">
                                            <span class="current-price">180.000₫</span>
                                        </div>
                                        <div class="product-actions">
                                            <button class="btn btn-primary btn-sm flex-fill">Thêm giỏ hàng</button>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </div>

                        <div class="col-md-3 col-sm-6 mb-4">
                            <a href="#" class="text-decoration-none">
                                <div class="product-card">
                                    <div class="product-image-container">
                                        <img src="https://images.unsplash.com/photo-1596755389378-c31d21fd1273?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80" 
                                             class="product-image" alt="Son môi organic">
                                    </div>
                                    <div class="product-info">
                                        <h6 class="product-name">Son môi organic</h6>
                                        <p class="product-description">Son môi từ thành phần hữu cơ 100%</p>
                                        <div class="product-rating">
                                            <span class="star">☆</span>
                                            <span class="star">☆</span>
                                            <span class="star">☆</span>
                                            <span class="star">☆</span>
                                            <span class="star">☆</span>
                                            <span class="review-count">(0)</span>
                                        </div>
                                        <div class="product-price">
                                            <span class="current-price">280.000₫</span>
                                        </div>
                                        <div class="product-actions">
                                            <button class="btn btn-primary btn-sm flex-fill">Thêm giỏ hàng</button>
                                        </div>
                                    </div>
                                </div>
                            </a>
                        </div>
                    }
                </div>
            </div>
        </div>
        
        <!-- Carousel controls -->
        <button class="carousel-control-prev" type="button" data-bs-target="#productCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#productCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
        </button>
        
        <!-- Carousel indicators -->
        <div class="carousel-indicators">
            <button type="button" data-bs-target="#productCarousel" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
        </div>
    </div>
</div>

<!-- Khu vực đánh giá nổi bật -->
<div class="reviews-section">
    <div class="container">
        <h2 class="text-center section-title">Đánh giá nổi bật</h2>
        <div class="row justify-content-center">
            <div class="col-md-4 mb-4">
                <div class="review-card">
                    <div class="d-flex align-items-center mb-3">
                        <img src="https://images.unsplash.com/photo-1494790108755-2616b612b786?ixlib=rb-4.0.3&auto=format&fit=crop&w=80&q=80" 
                             class="rounded-circle me-3" width="50" height="50" alt="Avatar">
                        <div>
                            <h6 class="mb-0 text-primary-green">Minh Anh</h6>
                            <small class="text-muted">Khách hàng thân thiết</small>
                        </div>
                    </div>
                    <p class="card-text">"Sản phẩm rất tốt! Da tôi trở nên mềm mại và sáng khỏe hơn nhiều sau khi sử dụng."</p>
                    <div class="stars">⭐⭐⭐⭐⭐</div>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="review-card">
                    <div class="d-flex align-items-center mb-3">
                        <img src="https://images.unsplash.com/photo-1438761681033-6461ffad8d80?ixlib=rb-4.0.3&auto=format&fit=crop&w=80&q=80" 
                             class="rounded-circle me-3" width="50" height="50" alt="Avatar">
                        <div>
                            <h6 class="mb-0 text-primary-green">Thu Hương</h6>
                            <small class="text-muted">Khách hàng VIP</small>
                        </div>
                    </div>
                    <p class="card-text">"Chất lượng tuyệt vời, hoàn toàn từ thiên nhiên. Sẽ tiếp tục ủng hộ shop!"</p>
                    <div class="stars">⭐⭐⭐⭐⭐</div>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="review-card">
                    <div class="d-flex align-items-center mb-3">
                        <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=80&q=80" 
                             class="rounded-circle me-3" width="50" height="50" alt="Avatar">
                        <div>
                            <h6 class="mb-0 text-primary-green">Đức Minh</h6>
                            <small class="text-muted">Khách hàng mới</small>
                        </div>
                    </div>
                    <p class="card-text">"Giao hàng nhanh, đóng gói cẩn thận. Sản phẩm đúng như mô tả, rất hài lòng!"</p>
                    <div class="stars">⭐⭐⭐⭐</div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Custom JavaScript cho trang chủ nếu cần
        // Có thể override hoặc extend functions từ trangchu.js
    </script>
}
